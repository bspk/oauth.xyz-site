{"version":3,"sources":["webpack://oauth.xyz/./src/pages/tokens.mdx","webpack://oauth.xyz/./src/components/header.js","webpack://oauth.xyz/./src/components/layout.js"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","title","keywords","to","from","code","language","codeString","proof","jwk","parentName","isMDXComponent","menuLinks","name","link","location","className","style","margin","color","textDecoration","src","alt","map","class","children","maxWidth","padding","paddingTop"],"mappings":"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","file":"component---src-pages-tokens-mdx-c1bcca8fe15aa8eeace9.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/jricher/Projects/oauth.xyz-site/src/components/layout.js\";\nimport { Link } from 'gatsby';\nimport SEO from '../components/seo';\nimport Code from '../components/code';\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n\n    <SEO title=\"Tokens\" keywords={['oauth', 'authorization', 'security']} mdxType=\"SEO\" />\n    <h1>{`Tokens`}</h1>\n    <p>{`Tokens in GNAP are issued in response to a request for access from the client instance. Unlike OAuth 2, tokens are never issued in the front channel via the browser regardless of the mode or type of client.`}</p>\n    <p>{`Access token formats and values are opaque to the client, but must be known to both the AS (so that it can issue them), and sometimes to the RS (so that it can interpret them, unless it uses an externalized service for doing so). In all of these examples, we'll be using a reference-style opaque token value.`}</p>\n    <h2>{`Key-bound Access Tokens`}</h2>\n    <p>{`By default, tokens in GNAP are issued bound to a key. `}<Link to=\"/keys\" mdxType=\"Link\">{`Proof of possession of the token's bound key`}</Link>{` must be presented alongside the token whenever that token is used. `}</p>\n    <p>{`Unless otherwise specified by the AS, this key is the same key and proof mechanism the client instance proved possession of in its initial `}<Link to=\"/transactionrequest\" mdxType=\"Link\">{`request`}</Link>{`.`}</p>\n    <Code from=\"as\" to=\"client\" code={{\n      \"access_token\": {\n        \"value\": \"OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0\",\n        \"access\": [\"one\", \"two\", \"and another thing\"]\n      }\n    }} mdxType=\"Code\" />\n    <p>{`Bound access tokens are presented using the proofing mechanism associated with the key.`}</p>\n    <Code from=\"client\" to=\"as\" language='http' codeString={`GET /resource HTTP/1.1\nHost: resources.example.com\nSignature-Input: gnap=(\"@request-target\" \"host\" \"authorization\");created=1624564850;keyid=\"xyz-client\"\nSignature: gnap=:EN/rExQ/knVi61P5AFhyMGN7aVPzk/9C7nsYAWF2RvzsoV1uNxGZklM55qCIQpuhoNty4EhiH7iwuzZBbRCQcQ==:\nAuthorization: GNAP OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0`} mdxType=\"Code\" />\n    <p>{`Bound tokens are used both at calls to the RS as well as all calls to the `}<Link to=\"/continue\" mdxType=\"Link\">{`continuation endpoint`}</Link>{` at the AS.`}</p>\n    <h2>{`AS-supplied Token Keys`}</h2>\n    <p>{`Alternatively, the AS can generate a key key generated by the AS and handed to the client as part of the token response, using the same structures the client instance uses to describe its keys and bindings.`}</p>\n    <Code from=\"as\" to=\"client\" code={{\n      \"access_token\": {\n        \"value\": \"OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0\",\n        \"access\": [\"one\", \"two\", \"and another thing\"],\n        \"key\": {\n          proof: \"httpsig\",\n          jwk: {\n            \"kty\": \"EC\",\n            \"d\": \"wcHNx8kkBCcBnGY39K995TShcdOFdKtaRQLGrUELqBI\",\n            \"crv\": \"P-256\",\n            \"x\": \"m5dnqNXawIKF3qyCfs_raR1LtTKUtyf4t2uVa4Wmd6A\",\n            \"y\": \"prF8Lo5JC2JTyj2GwtaI2LWWEaRa6v6XykjUMg-9C1U\",\n            \"alg\": \"ES256\"\n          }\n        }\n      }\n    }} mdxType=\"Code\" />\n    <p>{`The client instance then uses this specified key when presenting the token, instead of its own key. The AS could choose this mode of operation if it knows the downstream RS needs a particular kind of key presentation, or needs a derived key. However, it's more common (and therefore the default behavior) for the AS to bind to the client's own key.`}</p>\n    <h2>{`Bearer Tokens`}</h2>\n    <p>{`A token issued without an associated key is a bearer token, and any party with access to the token can present it to the RS. Bearer tokens are requested by setting the `}<inlineCode parentName=\"p\">{`bearer`}</inlineCode>{` flag in the `}<Link to=\"/transactionrequest\" mdxType=\"Link\">{`request`}</Link>{`.`}</p>\n    <Code from=\"client\" to=\"as\" code={{\n      \"access_token\": {\n        \"flags\": [\"bearer\"],\n        \"access\": [\"dolphin-metadata\", \"and another thing\"]\n      }\n    }} mdxType=\"Code\" />\n    <p>{`If issued, a bearer token has the `}<inlineCode parentName=\"p\">{`bound`}</inlineCode>{` field of the access token response set to `}<inlineCode parentName=\"p\">{`false`}</inlineCode>{` in the `}<Link to=\"/transactionresponse\" mdxType=\"Link\">{`response`}</Link>{`. `}</p>\n    <Code from=\"as\" to=\"client\" code={{\n      \"access_token\": {\n        \"value\": \"OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0\",\n        \"access\": [\"dolphin-metadata\", \"and another thing\"],\n        \"bound\": false\n      }\n    }} mdxType=\"Code\" />\n    <p>{`The client instance sends this token to the RS using `}<inlineCode parentName=\"p\">{`Authorization`}</inlineCode>{` header method defined in RFC6750.`}</p>\n    <Code from=\"client\" to=\"rs\" language='http' codeString={`GET / HTTP/1.1\nHost: server.example.com\nAuthorization: Bearer OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0`} mdxType=\"Code\" />\n    <h2>{`Multiple access tokens`}</h2>\n    <p>{`A client can make a `}<Link to=\"/transactionrequest\" mdxType=\"Link\">{`request`}</Link>{` with a multi-part `}<inlineCode parentName=\"p\">{`access_token`}</inlineCode>{` section, which is formatted as a JSON array. Each object in the request requires a `}<inlineCode parentName=\"p\">{`label`}</inlineCode>{` field with names chosen by the client to differentiate the access being requested. A request would look like this.`}</p>\n    <Code from=\"client\" to=\"as\" code={{\n      \"access_token\": [{\n        \"label\": \"token1\",\n        \"access\": [{\n          \"type\": \"example.com/resource-set\",\n          \"actions\": [\"read\", \"write\", \"dolphin\"],\n          \"locations\": [\"https://server.example.net/\", \"https://resource.local/other\"],\n          \"datatypes\": [\"metadata\", \"images\"]\n        }]\n      }, {\n        \"label\": \"token2\",\n        \"access\": [{\n          \"type\": \"example.com/another-api\",\n          \"actions\": [\"foo\", \"bar\", \"dolphin\"],\n          \"locations\": [\"https://resource.other/\"],\n          \"datatypes\": [\"data\", \"pictures\"]\n        }]\n      }]\n    }} mdxType=\"Code\" />\n    <p>{`The returned access token structure is similar, with an array of uniquely-labeled access token objects.`}</p>\n    <Code from=\"as\" to=\"client\" code={{\n      \"access_token\": [{\n        \"label\": \"token1\",\n        \"value\": \"OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0\",\n        \"access\": [{\n          \"type\": \"example.com/resource-set\",\n          \"actions\": [\"read\", \"write\", \"dolphin\"],\n          \"locations\": [\"https://server.example.net/\", \"https://resource.local/other\"],\n          \"datatypes\": [\"metadata\", \"images\"]\n        }]\n      }, {\n        \"label\": \"token2\",\n        \"value\": \"UFGLO2FDAFG7VGZZPJ3IZEMN21EVU71FHCARP4J1\",\n        \"access\": [{\n          \"type\": \"example.com/another-api\",\n          \"actions\": [\"foo\", \"bar\", \"dolphin\"],\n          \"locations\": [\"https://resource.other/\"],\n          \"datatypes\": [\"data\", \"pictures\"]\n        }]\n      }]\n    }} mdxType=\"Code\" />\n    <p>{`The `}<inlineCode parentName=\"p\">{`token1`}</inlineCode>{` access token in the response corresponds directly to the `}<inlineCode parentName=\"p\">{`token1`}</inlineCode>{` portion of the request, and the same applies to `}<inlineCode parentName=\"p\">{`token2`}</inlineCode>{`. The AS can't add an additional access token that the client did not specifically request (unless the advanced token splitting functionality is requested), but it can omit a requested access token in case it was not issued. This could be because the user denied the authorization request or some other policy decision required it. Each access token could have different flags, different management, and of course different access rights. `}</p>\n    <h1>{`Managing Access Tokens`}</h1>\n    <p>{`If the access token is issued alongside a token management URI:`}</p>\n    <Code from=\"as\" to=\"client\" code={{\n      \"access_token\": {\n        \"value\": \"OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0\",\n        \"access\": [\"one\", \"two\", \"and another thing\"],\n        \"manage\": \"https://server.example.com/token/PRY5NM33OM4TB8N6BW7OZB8CDFONP219RP1L\"\n      }\n    }} mdxType=\"Code\" />\n    <p>{`Then the client can send a POST request to the token management URL to get a new access token.`}</p>\n    <p>{`The token itself is used to access the API at the management URL. If the token is bound to a specific key, the client has to present that key with the token as in any other request using the token. However, if the token is a `}<inlineCode parentName=\"p\">{`bearer`}</inlineCode>{` token, the client has to prove possession of the same key that was used to issue the token. That is to say, bearer tokens are never used as the sole credentials for their own management.`}</p>\n    <h2>{`Rotating Access Tokens`}</h2>\n    <p>{`To rotate a token, the client sends an empty HTTP `}<inlineCode parentName=\"p\">{`POST`}</inlineCode>{` to the token management URL.`}</p>\n    <Code from=\"client\" to=\"as\" language='http' codeString={`POST /token/PRY5NM33OM4TB8N6BW7OZB8CDFONP219RP1L HTTP/1.1\nHost: server.example.com\nSignature-Input: gnap=(\"@request-target\" \"host\" \"authorization\");created=1624564850;keyid=\"xyz-client\"\nSignature: gnap=:g0icu7VRfKaAmnArofz1m/S7ZdnybSO6gMncvwrUvWIXfB/DBltK0arEo5PqAv5vUKXSEb/7zkqZM4eeMf3xDg==:\nAuthorization: GNAP OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0`} mdxType=\"Code\" />\n    <p>{`If the management URI is still valid, the AS revokes the old access token (if possible) and issues the new access token using the same format as in the `}<Link to=\"/transactionresponse\" mdxType=\"Link\">{`response`}</Link>{`.`}</p>\n    <Code from=\"as\" to=\"client\" code={{\n      \"access_token\": {\n        \"value\": \"FKPLDO5394XVIWHVNR7POUNC4OYJ2LWKYYZGKFS6\",\n        \"access\": [\"one\", \"two\", \"and another thing\"],\n        \"manage\": \"https://server.example.com/token/PRY5NM33OM4TB8N6BW7OZB8CDFONP219RP1L\"\n      }\n    }} mdxType=\"Code\" />\n    <p>{`Note that since this process could result in the management URL rotating upon each use. If no management URL is returned, the client can no longer rotate the token.`}</p>\n    <p>{`If the client instance wants to get a new access token with a different set of rights, it can't use the token rotation mechanism and instead needs to send a `}<Link to=\"/continue\" mdxType=\"Link\">{`continuation request`}</Link>{` with the new parameters.`}</p>\n    <h2>{`Revoking Access Tokens`}</h2>\n    <p>{`A client can request the revocation of a token by sending a `}<inlineCode parentName=\"p\">{`DELETE`}</inlineCode>{` request to the token management URL.`}</p>\n    <Code from=\"client\" to=\"rs\" language='http' codeString={`DELETE /token/PRY5NM33OM4TB8N6BW7OZB8CDFONP219RP1L HTTP/1.1\nHost: server.example.com\nSignature-Input: gnap=(\"@request-target\" \"host\" \"authorization\");created=1624564850;keyid=\"xyz-client\"\nSignature: gnap=:mcHk93cUDq1h/fb073O6oQM0Ek8tT+i2yZZHQOy05yLu0iiRUmVHC0K8m/kaB1Q/SXLYZeoadClcq7TVTvmZOA==:\nAuthorization: Bearer OS9M2PMHKUR64TB8N6BW7OZB8CDFONP219RP1LT0`} mdxType=\"Code\" />\n    <p>{`Both the AS and client throw out the access token after completion of the revocation.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      ","import { Link, graphql } from 'gatsby'\nimport { Location } from '@reach/router';\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nconst menuLinks = [\n      {\n        name: 'Request',\n        link: '/transactionrequest/'\n      },\n      {\n        name: 'Continue',\n        link: '/continue/'\n      },\n      {\n        name: 'Response',\n        link: '/transactionresponse/'\n      },\n      {\n        name: 'Interaction',\n        link: '/interaction/'\n      },\n      {\n        name: 'Keys',\n        link: '/keys/'\n      },\n      {\n        name: 'Tokens',\n        link: '/tokens/'\n      },\n      {\n        name: 'Discovery',\n        link: '/discovery/'\n      },\n      {\n        name: 'Other Specs',\n        link: '/specs/'\n      },\n      {\n        name: 'About',\n        link: '/about/'\n      },\n]\n\nconst Header = ({ location }) => (\n  <div className=\"header\">\n    <div className=\"wrapper\">\n      <h1 style={{ margin: 0 }}>\n        <Link\n          to=\"/\"\n          style={{\n            color: 'white',\n            textDecoration: 'none',\n          }}\n        >\n          <img src=\"/xyz.png\" alt=\"XYZ\" className=\"logo\" />\n          XYZ: Implementing GNAP\n        </Link>\n      </h1>\n          <nav>\n            {\n              menuLinks.map(link =>\n                  <Link to={link.link}><span>&raquo;</span> {link.name}</Link>\n              )\n            }\n          </nav>\n    </div>\n    <div class=\"subnav\">\n            \n    </div>\n  </div>\n)\n\nexport default Header\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { StaticQuery, graphql } from 'gatsby'\n\nimport Header from './header'\nimport 'bootstrap/dist/css/bootstrap.css'\nimport './layout.css'\n\nconst Layout = ({ children }) => (\n      <>\n        <Header/>\n        <div\n          style={{\n            margin: '0 auto',\n            maxWidth: 960,\n            padding: '0px 1.0875rem 1.45rem',\n            paddingTop: 0,\n          }}\n        >\n          {children}\n        </div>\n      </>\n)\n\nLayout.propTypes = {\n  children: PropTypes.node.isRequired,\n}\n\nexport default Layout\n"],"sourceRoot":""}